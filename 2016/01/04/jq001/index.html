<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="google-site-verification" content="eGNFdt2ztR4hEzEBjDkGQUWo0r_iPHpw1hoLqy-UUb0" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1" />
  <meta name="renderer" content="webkit">
  
  <title>jQuery源码学习--001大体分析 | ThinkerChan</title>
  <meta name="description" content="大体结构1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950(function( window, undefined ) &amp;#123;  // 缓存读取部分  var document = window.document,  navigator = window.nav">
<meta name="keywords" content="jq源码学习,jquery源码">
<meta property="og:type" content="article">
<meta property="og:title" content="jQuery源码学习--001大体分析">
<meta property="og:url" content="http://thinkerchan.com/2016/01/04/jq001/index.html">
<meta property="og:site_name" content="ThinkerChan">
<meta property="og:description" content="大体结构1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950(function( window, undefined ) &amp;#123;  // 缓存读取部分  var document = window.document,  navigator = window.nav">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2016-01-19T01:44:13.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jQuery源码学习--001大体分析">
<meta name="twitter:description" content="大体结构1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950(function( window, undefined ) &amp;#123;  // 缓存读取部分  var document = window.document,  navigator = window.nav">
<meta name="twitter:creator" content="@thinkerchan">
<meta property="fb:admins" content="thinkerchan">
  
  <link rel="alternate" href="/atom.xml" title="ThinkerChan" type="application/rss+xml">
  

  <link rel="stylesheet" href="/css/style.css" >
  <link rel="shortcut icon" href="/images/favicon.png"/>
  <script data-main="/js/build" src="/js/require.js"></script>
  <!--[if lt IE 7]>
  <style>
    .section{
      width: 780px;
    }
    .post-content img{
      width: 100%;
    }
    .jupe pre{
      width: 100%;
    }
  </style>
  <![endif]-->
</head>
<body>

<div class="section-wrap section-main">
	<div class="section">
		<div class="header">
	<h1 class="logo">
		<a href="/">ThinkerChan</a>
	</h1>
	<p class="social-links">
		<a href="http://weibo.com/thinkerchank/" target="_blank">Weibo</a>
		/
		<a href="https://www.zhihu.com/people/fattychan/activities" target="_blank">Zhihu</a>
		/
		<a href="https://github.com/thinkerchan" target="_blank">Github</a>
	</p>
</div>
		<div class="main">
						<div class="jupe main-body">
				<div class="post-content">
					<h1 class="post-title">jQuery源码学习--001大体分析</h1>
					<div class="post-meta">
						<span class="post-time">2016.01.04</span>
						<div class="post-cats">
							<a class="post-cats-item-link" href="/categories/jQuery/">jQuery</a>
						</div>
					</div>
					<div class="post-toc">
						<div class="toc-title">TOC</div>
						<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#大体结构"><span class="toc-number">1.</span> <span class="toc-text">大体结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jQuery-fn-init"><span class="toc-number">2.</span> <span class="toc-text">jQuery.fn.init</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jQuery-extend-jQuery-fn-extend"><span class="toc-number">3.</span> <span class="toc-text">jQuery.extend = jQuery.fn.extend</span></a></li></ol>
					</div>
					<h2 id="大体结构"><a href="#大体结构" class="headerlink" title="大体结构"></a>大体结构</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"> window, undefined </span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 缓存读取部分</span></span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">document</span> = <span class="built_in">window</span>.document,</span><br><span class="line">  navigator = <span class="built_in">window</span>.navigator,</span><br><span class="line">  location = <span class="built_in">window</span>.location;</span><br><span class="line">  <span class="comment">// 闭包</span></span><br><span class="line">  <span class="keyword">var</span> jQuery = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;  <span class="comment">//jQuery对象不是通过  new jQuery的, 而是通过  new jQuery.fn.init 创建的</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init( selector, context, rootjQuery );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//这里省略一堆变量</span></span><br><span class="line">    ;</span><br><span class="line">    <span class="comment">// 原型</span></span><br><span class="line">    jQuery.fn = jQuery.prototype = &#123;</span><br><span class="line">      <span class="keyword">constructor</span>: jQuery,</span><br><span class="line">      init: function( selector, context, rootjQuery ) &#123; <span class="comment">//这个方法非常重要</span></span><br><span class="line">      <span class="comment">// selector有以下7种分支情况：</span></span><br><span class="line">      <span class="comment">// DOM元素</span></span><br><span class="line">      <span class="comment">// body（优化）</span></span><br><span class="line">      <span class="comment">// 字符串：HTML标签、HTML字符串、#id、选择器表达式</span></span><br><span class="line">      <span class="comment">// 函数（作为ready回调函数）</span></span><br><span class="line">      <span class="comment">// 最后返回伪数组</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 省略一堆属性...</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//这一句非常关键 , 意味着 init方法(函数)和jQuery有共同的原型对象 , 因此通过init生成的对象实例,都能调用jQuery的所有方法</span></span><br><span class="line">    jQuery.fn.init.prototype = jQuery.fn;</span><br><span class="line">    <span class="comment">// 合并内容到第一个参数中，后续大部分功能都通过该函数扩展</span></span><br><span class="line">    <span class="comment">// 通过jQuery.fn.extend扩展的函数，大部分都会调用通过jQuery.extend扩展的同名函数</span></span><br><span class="line">    jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    <span class="comment">// 在jQuery上扩展静态方法</span></span><br><span class="line">    jQuery.extend(&#123;</span><br><span class="line">    <span class="comment">// ready bindReady</span></span><br><span class="line">    <span class="comment">// isPlainObject isEmptyObject</span></span><br><span class="line">    <span class="comment">// parseJSON parseXML</span></span><br><span class="line">    <span class="comment">// globalEval</span></span><br><span class="line">    <span class="comment">// each makeArray inArray merge grep map</span></span><br><span class="line">    <span class="comment">// proxy</span></span><br><span class="line">    <span class="comment">// access</span></span><br><span class="line">    <span class="comment">// uaMatch</span></span><br><span class="line">    <span class="comment">// sub</span></span><br><span class="line">    <span class="comment">// browser</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 到这里，jQuery对象构造完成，后边的代码都是对jQuery或jQuery对象的扩展</span></span><br><span class="line">    <span class="keyword">return</span> jQuery; <span class="comment">// 返回jQuery对象实例 最外层的 jQuery暴露在全局并且用$等价 , 就直接$()即可</span></span><br><span class="line">  &#125;)();</span><br><span class="line">  <span class="comment">// 暴露到全局</span></span><br><span class="line">  <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure>
<h2 id="jQuery-fn-init"><a href="#jQuery-fn-init" class="headerlink" title="jQuery.fn.init"></a>jQuery.fn.init</h2><p>jQuery.fn.init的功能是对传进来的selector参数进行分析，进行各种不同的处理，然后生成jQuery对象</p>
<table>
<thead>
<tr>
<th style="text-align:center">参数类型</th>
<th style="text-align:center">处理方式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DOM元素</td>
<td style="text-align:center">包装成jQuery对象</td>
</tr>
<tr>
<td style="text-align:center">body</td>
<td style="text-align:center">document.body提取</td>
</tr>
<tr>
<td style="text-align:center">html标签</td>
<td style="text-align:center">document.createElement</td>
</tr>
<tr>
<td style="text-align:center">html字符串</td>
<td style="text-align:center">document.createDocumentFragment</td>
</tr>
<tr>
<td style="text-align:center">id</td>
<td style="text-align:center">document.getElementById</td>
</tr>
<tr>
<td style="text-align:center">selector</td>
<td style="text-align:center">$().find</td>
</tr>
<tr>
<td style="text-align:center">fn</td>
<td style="text-align:center">注册到dom ready的回调函数</td>
</tr>
</tbody>
</table>
<h2 id="jQuery-extend-jQuery-fn-extend"><a href="#jQuery-extend-jQuery-fn-extend" class="headerlink" title="jQuery.extend = jQuery.fn.extend"></a>jQuery.extend = jQuery.fn.extend</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 合并两个或更多对象的属性到第一个对象中，jQuery后续的大部分功能都通过该函数扩展</span></span><br><span class="line"><span class="comment">// 通过jQuery.fn.extend扩展的函数，大部分都会调用通过jQuery.extend扩展的同名函数</span></span><br><span class="line"><span class="comment">// 如果传入两个或多个对象，所有对象的属性会被添加到第一个对象target</span></span><br><span class="line"><span class="comment">// 如果只传入一个对象，则将对象的属性添加到jQuery对象中。</span></span><br><span class="line"><span class="comment">// 用这种方式，我们可以为jQuery命名空间增加新的方法。可以用于编写jQuery插件。</span></span><br><span class="line"><span class="comment">// 如果不想改变传入的对象，可以传入一个空对象：$.extend(&#123;&#125;, object1, object2);</span></span><br><span class="line"><span class="comment">// 默认合并操作是不迭代的，即便target的某个属性是对象或属性，也会被完全覆盖而不是合并</span></span><br><span class="line"><span class="comment">// 第一个参数是true，则会迭代合并</span></span><br><span class="line"><span class="comment">// 从object原型继承的属性会被拷贝</span></span><br><span class="line"><span class="comment">// undefined值不会被拷贝</span></span><br><span class="line"><span class="comment">// 因为性能原因，JavaScript自带类型的属性不会合并</span></span><br><span class="line"><span class="comment">// jQuery.extend( target, [ object1 ], [ objectN ] )</span></span><br><span class="line"><span class="comment">// jQuery.extend( [ deep ], target, object1, [ objectN ] )</span></span><br><span class="line">jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> options, name, src, copy, copyIsArray, clone,</span><br><span class="line">       target = <span class="built_in">arguments</span>[<span class="number">0</span>] || &#123;&#125;,</span><br><span class="line">       i = <span class="number">1</span>,</span><br><span class="line">       length = <span class="built_in">arguments</span>.length,</span><br><span class="line">       deep = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// Handle a deep copy situation</span></span><br><span class="line">    <span class="comment">// 如果第一个参数是boolean型，可能是深度拷贝</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> target === <span class="string">"boolean"</span> ) &#123;</span><br><span class="line">       deep = target;</span><br><span class="line">       target = <span class="built_in">arguments</span>[<span class="number">1</span>] || &#123;&#125;;</span><br><span class="line">       <span class="comment">// skip the boolean and the target</span></span><br><span class="line">       <span class="comment">// 跳过boolean和target，从第3个开始</span></span><br><span class="line">       i = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Handle case when target is a string or something (possible in deep copy)</span></span><br><span class="line">    <span class="comment">// target不是对象也不是函数，则强制设置为空对象</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> target !== <span class="string">"object"</span> &amp;&amp; !jQuery.isFunction(target) ) &#123;</span><br><span class="line">       target = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// extend jQuery itself if only one argument is passed</span></span><br><span class="line">    <span class="comment">// 如果只传入一个参数，则认为是对jQuery扩展</span></span><br><span class="line">    <span class="keyword">if</span> ( length === i ) &#123;</span><br><span class="line">       target = <span class="keyword">this</span>;</span><br><span class="line">       --i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">       <span class="comment">// Only deal with non-null/undefined values</span></span><br><span class="line">       <span class="comment">// 只处理非空参数</span></span><br><span class="line">       <span class="keyword">if</span> ( (options = <span class="built_in">arguments</span>[ i ]) != <span class="literal">null</span> ) &#123;</span><br><span class="line">           <span class="comment">// Extend the base object</span></span><br><span class="line">           <span class="keyword">for</span> ( name <span class="keyword">in</span> options ) &#123;</span><br><span class="line">              src = target[ name ];</span><br><span class="line">              copy = options[ name ];</span><br><span class="line">              <span class="comment">// Prevent never-ending loop</span></span><br><span class="line">              <span class="comment">// 避免循环引用</span></span><br><span class="line">              <span class="keyword">if</span> ( target === copy ) &#123;</span><br><span class="line">                  <span class="keyword">continue</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="comment">// Recurse if we're merging plain objects or arrays</span></span><br><span class="line">              <span class="comment">// 深度拷贝且值是纯对象或数组，则递归</span></span><br><span class="line">              <span class="keyword">if</span> ( deep &amp;&amp; copy &amp;&amp; ( jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)) ) ) &#123;</span><br><span class="line">                  <span class="comment">// 如果copy是数组</span></span><br><span class="line">                  <span class="keyword">if</span> ( copyIsArray ) &#123;</span><br><span class="line">                     copyIsArray = <span class="literal">false</span>;</span><br><span class="line">                     <span class="comment">// clone为src的修正值</span></span><br><span class="line">                     clone = src &amp;&amp; jQuery.isArray(src) ? src : [];</span><br><span class="line">                  <span class="comment">// 如果copy的是对象</span></span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                     <span class="comment">// clone为src的修正值</span></span><br><span class="line">                     clone = src &amp;&amp; jQuery.isPlainObject(src) ? src : &#123;&#125;;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="comment">// Never move original objects, clone them</span></span><br><span class="line">                  <span class="comment">// 递归调用jQuery.extend</span></span><br><span class="line">                  target[ name ] = jQuery.extend( deep, clone, copy );</span><br><span class="line">              <span class="comment">// Don't bring in undefined values</span></span><br><span class="line">              <span class="comment">// 不能拷贝空值</span></span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( copy !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">                  target[ name ] = copy;</span><br><span class="line">              &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Return the modified object</span></span><br><span class="line">    <span class="comment">// 返回更改后的对象</span></span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

					<div class="post-share">
	<ul class="share-list">
		<li><a class="icon icon-weibo" href="javascript:share.weibo();"><span>weibo</span></a></li>
		<li>
      <a class="icon icon-wechat" onmouseenter="share.wechat(this)"  onmouseleave="share.wechatHide()">
        <div class="wechat-qrcode" id="qrcodeBox">
          <img width="160" height="160" class="wechat-qrcode-img" id="wechatQrcodeImg">
          <em class="wechat-tri"></em>
        </div>
        <span>wechat</span>
      </a>
    </li>
		<li><a class="icon icon-qzone" href="javascript:share.qzone();"><span>qzone</span></a></li>
	</ul>
</div>
				</div>
			</div>		</div>
		<div class="footer">
  <p class="left">&copy; Thinker Chan</p>
	<p class="right">Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a> , Theme by <a href="http://yujiangshui.com/" target="_blank">于江水</a> .</p>
</div>
	</div>
</div>

</body>
</html>