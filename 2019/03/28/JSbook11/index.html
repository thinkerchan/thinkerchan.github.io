<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <link rel="dns-prefetch" href="https://thinkerchan.com">
  
  <title>JS红皮书读书笔记-11-DOM扩展 | 测试狗</title>
  <meta name="author" content="测试狗">
  
  <meta name="description" content="🐶">
  
  
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

  <meta property="og:title" content="JS红皮书读书笔记-11-DOM扩展"/>
  <meta property="og:site_name" content="测试狗"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="alternate" href="/atom.xml" title="测试狗" type="application/atom+xml">

  <link rel="preload" as="style" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="https://github.githubassets.com/favicons/favicon.svg">
  <link href="https://unpkg.com" rel="dns-prefetch" />
  <link href="https://busuanzi.ibruce.info" rel="dns-prefetch" />
  <link href="https://cdn1.lncld.net" rel="dns-prefetch" />
  
  <link href="https://xpjzs0ff.api.lncld.net" rel="dns-prefetch" />
  
</head>

<body>
  <div class="container">
    <div class="left-col" style="background-image:url('https://tva1.sinaimg.cn/large/007S8ZIlly1giq5k8ty3tj306y0zkdix.jpg')">
      <div class="intrude-less">
        <header id="header" class="inner">
          <a href="/">
            <div class="profilepic"><img class="avatar" src='https://tva1.sinaimg.cn/large/007S8ZIlly1giq5t0agwnj30bf0b4jrk.jpg'></div>
          </a>
          <div class="author-name"><a href="/">测试狗</a></div>
          <p class="aboutme">🐶</p>
          <nav id="main-nav">
            <ul class="main">
              
              <li>
                
                  <a href="/archives">归档</a>
                
              </li>
              
              <li>
                
                  <a href="/categories">专题</a>
                
              </li>
              
              <li>
                
                  <a href="/friendlinks">友链</a>
                
              </li>
              
              <li>
                
                  <a href="/life">关于</a>
                
              </li>
              
              <li>
                
                  <a href="/search">搜索</a>
                
              </li>
              
            </ul>
          </nav>
          <nav id="sub-nav">
            <div class="social">
              
              <a class="twitter" href="https://twitter.com/thinkerchan" title="Twitter">Twitter</a>
              
              
              
              <a class="github" href="https://github.com/thinkerchan" title="Github">Github</a>
              
              
              <a class="yuque" href="https://yuque.com/testdog" title="语雀">语雀</a>
              

              
            </div>
          </nav>
        </header>
      </div>
    </div>
    <div class="mid-col">
      <div class="mid-col-container">
        <div id="content" class="inner">
          <article class="post">

  
    <div class="meta">
      
<div class="date">

<time datetime="2019-03-28T15:46:00.000Z"
      
      data-updated="true"
       itemprop="datePublished">
  2019-03-28
</time>





</div>

    </div>
  
  <h1 class="title" itemprop="name">JS红皮书读书笔记-11-DOM扩展</h1>
  <div class="entry-content" itemprop="articleBody">
    
    <div class="post-toc">
      <div class="toc-title">TOC</div>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#选择符API"><span class="toc-number">1.</span> <span class="toc-text">选择符API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#querySelector"><span class="toc-number">1.1.</span> <span class="toc-text">querySelector</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#querySelectorAll"><span class="toc-number">1.2.</span> <span class="toc-text">querySelectorAll</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#matchesSelector"><span class="toc-number">1.3.</span> <span class="toc-text">matchesSelector</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#元素遍历"><span class="toc-number">2.</span> <span class="toc-text">元素遍历</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML5"><span class="toc-number">3.</span> <span class="toc-text">HTML5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#扩展与Class相关的操作"><span class="toc-number">3.1.</span> <span class="toc-text">扩展与Class相关的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#焦点管理"><span class="toc-number">3.2.</span> <span class="toc-text">焦点管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTMLDocument的变化"><span class="toc-number">3.3.</span> <span class="toc-text">HTMLDocument的变化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符集属性"><span class="toc-number">3.4.</span> <span class="toc-text">字符集属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义数据属性"><span class="toc-number">3.5.</span> <span class="toc-text">自定义数据属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插入标记"><span class="toc-number">3.6.</span> <span class="toc-text">插入标记</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插入文本"><span class="toc-number">3.7.</span> <span class="toc-text">插入文本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#滚动"><span class="toc-number">3.8.</span> <span class="toc-text">滚动</span></a></li></ol></li></ol>
    </div>
    
    <p>上一章讲了DOM相关的知识, 对此, DOM相关的API已经能满足绝大部分开发者的使用了. 但是jQuery实在是太强大,  以至于W3C对其选择器进行了参考, 而后进行了扩展.</p>
<h2 id="选择符API"><a href="#选择符API" class="headerlink" title="选择符API"></a>选择符API</h2><h3 id="querySelector"><a href="#querySelector" class="headerlink" title="querySelector"></a>querySelector</h3><p>用法:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> body = <span class="built_in">document</span>.querySelector(<span class="string">'body'</span>);</span><br><span class="line"><span class="keyword">var</span> id_body = <span class="built_in">document</span>.querySelector(<span class="string">'#body'</span>);</span><br><span class="line"><span class="keyword">var</span> class_body = <span class="built_in">document</span>.querySelector(<span class="string">'.body'</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="querySelectorAll"><a href="#querySelectorAll" class="headerlink" title="querySelectorAll"></a>querySelectorAll</h3><p>用法:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> divs = <span class="built_in">document</span>.querySelectorAll(<span class="string">'div'</span>);</span><br><span class="line"><span class="keyword">var</span> class_divs = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.div'</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="matchesSelector"><a href="#matchesSelector" class="headerlink" title="matchesSelector"></a><del>matchesSelector</del></h3><blockquote>
<p>笔者写此文的时候(2019年),此API已作废, 正确的API为 <code>matches</code></p>
</blockquote>
<p>此API用得比较少:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> body = <span class="built_in">document</span>.body;	<span class="comment">// 假设body.id="Jbody"</span></span><br><span class="line">body.matches(<span class="string">'#Jbody'</span>);	<span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<h2 id="元素遍历"><a href="#元素遍历" class="headerlink" title="元素遍历"></a>元素遍历</h2><p>略, 此处的API有点鸡肋</p>
<h2 id="HTML5"><a href="#HTML5" class="headerlink" title="HTML5"></a>HTML5</h2><p>这里只讲HTML5中与DOM相关的新扩展.</p>
<h3 id="扩展与Class相关的操作"><a href="#扩展与Class相关的操作" class="headerlink" title="扩展与Class相关的操作"></a>扩展与Class相关的操作</h3><ol>
<li><p>新增getElementByClassName<br>显然这个方法受到了jQuery的启发.</p>
</li>
<li><p>新增classList的操作<br>它又以下几个方法:</p>
</li>
</ol>
<ul>
<li>add(value)</li>
<li>remove(value)</li>
<li>contains(value)</li>
<li>toggle(value)</li>
</ul>
<p>以往我们<strong>删除</strong>(注意这里说的是删除)一个元素中的class中的某个值会比较麻烦,现在有了classList, 我们可以:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">div.classList.remove(<span class="string">'test'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="焦点管理"><a href="#焦点管理" class="headerlink" title="焦点管理"></a>焦点管理</h3><p>新增: </p>
<ul>
<li>document.activeElement: 当前焦点元素</li>
<li>document.hasFocus() : 检测文档是否获得焦点</li>
</ul>
<h3 id="HTMLDocument的变化"><a href="#HTMLDocument的变化" class="headerlink" title="HTMLDocument的变化"></a>HTMLDocument的变化</h3><ol>
<li>引入readyState: document. readyState 只有两种值: ‘loading’||’complete’</li>
<li>兼容模式: document.compatMode , 标准模式下它的值是 “CSS1Compat”,通常我们用不到这个属性</li>
<li>head属性: 类似document.body</li>
</ol>
<h3 id="字符集属性"><a href="#字符集属性" class="headerlink" title="字符集属性"></a>字符集属性</h3><p>document.charset, 略</p>
<h3 id="自定义数据属性"><a href="#自定义数据属性" class="headerlink" title="自定义数据属性"></a>自定义数据属性</h3><p>为了规范DOM元素中的自定义属性行为, HTML为开发者提供了自定义数据的属性, 看示例:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> div = Jdiv; <span class="comment">//假设存在一个这样的元素: &lt;div id="Jdiv" data-id="testDiv"&gt;&lt;/div&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取自定义属性的值</span></span><br><span class="line"><span class="keyword">var</span> _id = div.dataset.id;	<span class="comment">// "testDiv"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置</span></span><br><span class="line">div.dataset.name = <span class="string">"testdog"</span>;	<span class="comment">// "testdog"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="插入标记"><a href="#插入标记" class="headerlink" title="插入标记"></a>插入标记</h3><ol>
<li>innerHTML</li>
</ol>
<p>HTML5对这个属性做了一次加强, 比如:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在现代浏览器下, script标签会被忽略, 但是旧版本的IE依旧需要注意</span></span><br><span class="line"><span class="built_in">document</span>.body.innerHTML = <span class="string">'&lt;script&gt;alert(1)&lt;/script&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 另外, 使用innerHTML一定要注意XSS的问题</span></span><br><span class="line"><span class="built_in">document</span>.body.innerHTML = <span class="string">'&lt;img src="不存在的地址" onerror="alert(1)"&gt;'</span>;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>书上说: “并不是所有元素都支持innerHTML属性”, 这句话已经过时, 谨慎参考.</p>
</blockquote>
<ol start="2">
<li>outerHTML: 略</li>
<li>insertAdjacentHTML(插入位置, html字符串)<br>实际上这个方法早在IE就实现了(IE6都能用), 看下列示例很容易明白:</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- beforebegin --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"one"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- afterbegin --&gt;</span></span><br><span class="line">    foo</span><br><span class="line">    <span class="comment">&lt;!-- beforeend --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- afterend --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> d1 = <span class="built_in">document</span>.getElementById(<span class="string">'one'</span>);</span></span><br><span class="line"><span class="xml">    d1.insertAdjacentHTML('afterend', '<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"two"</span>&gt;</span>two<span class="tag">&lt;/<span class="name">div</span>&gt;</span>');</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">4. 内存和性能问题:</span><br><span class="line">使用innerHTML意味着性能的开销, 如非必要, 尽量少用innerHTML</span><br><span class="line"></span><br><span class="line">### scrollIntoView方法</span><br><span class="line">ele. scrollIntoView()即可让元素滚动到与浏览器窗口顶部.</span><br><span class="line"></span><br><span class="line">## 专有扩展</span><br><span class="line">### 文档模式</span><br><span class="line">略, 现在都用HTML5文档</span><br><span class="line"></span><br><span class="line">### children属性</span><br><span class="line">还记得之前的ele.childNodes吗? 虽然它返回的是nodeList对象, 但是nodeList中的元素节点, 其实就和ele.children是类似的, 只不过children返回的是HTMLcollection.</span><br><span class="line"></span><br><span class="line">### contains方法</span><br><span class="line">要检查一个元素是不是某一个节点的后代:</span><br><span class="line">``` js</span><br><span class="line">ele.contains(oneNode);	// bool</span><br></pre></td></tr></table></figure>
<p>当然DOM3也提供了一个方法:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ele1.compareDocumentPosition(ele2);</span><br></pre></td></tr></table></figure></p>
<p>这有一个参考: <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node/compareDocumentPosition" target="_blank" rel="noopener">MDN-compareDocumentPosition</a> , 但是因为这个API返回的结果还要进行位运算, 操作相对麻烦, 故不流行.</p>
<h3 id="插入文本"><a href="#插入文本" class="headerlink" title="插入文本"></a>插入文本</h3><p>innerText, outerText , 只操作文本内容. </p>
<h3 id="滚动"><a href="#滚动" class="headerlink" title="滚动"></a>滚动</h3><p>略, 目前ele. scrollIntoView()最常用.</p>

  </div>

</article>


  <nav id="pagenavi">
    
    <a href="/2019/04/02/JSbook12/" class="prev">上一篇：JS红皮书读书笔记-12-DOM2和DOM3(待更新)</a>
    
    
    <a href="/2019/03/28/JSbook10/" class="next">下一篇：JS红皮书读书笔记-10-DOM</a>
    
  </nav>

        </div>
        
        
          <div class="post-comments" id="Jcmt">
            <h1 class="post-comments-title">访客评论</h1>
            <div id="Jcomment"></div>
          </div>
        
      </div>
      <footer id="footer" class="inner">
        © 2021 - 测试狗 -
        <span id="busuanzi_container_site_pv">PV <span id="busuanzi_value_site_pv"></span></span>
        <p>Powered by <a href="https://hexo.io/">Hexo</a> & <a href="https://github.com/thinkerchan/hexo-theme-greyshade">GreyShade</a></p>
      </footer>
    </div>
  </div>
  
  <script>
    let mod ={
      timePrefix:'t-',
      expire:1000*60*60,
      load:function(libName,libUrl,cb){
        let aval = (new Date).getTime() - localStorage.getItem(this.timePrefix+libName) < this.expire;
        let libStr = localStorage.getItem(libName)
        if (aval && libStr) {
          this.parseAndInsert(libStr)
          cb && cb(libStr);
        }else{
          this.ajax(libUrl,(str)=>{
            localStorage.setItem(libName, str)
            localStorage.setItem(this.timePrefix+libName, (new Date).getTime())
            this.parseAndInsert(str)
            cb && cb(str);
          })
        }
      },
      parseAndInsert(rawStr) {
        let script = document.createElement('script')
        script.innerHTML = rawStr
        document.body.appendChild(script)
      },
      ajax:function(url,cb){
        let xhr = new XMLHttpRequest;
        xhr.open('get', url, true)
        xhr.send();
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            cb && cb(xhr.responseText)
          }else{
            // console.log(xhr.readyState,xhr.status);
          }
        }
      },
      genCmt(){
        window.Valine && new Valine({
          el: '#Jcomment',
          appId: 'XPJzs0FfufkFfuBjbJraqhbo-gzGzoHsz',
          appKey: 'QoS0zL4Y2xTDviitGOPkvCGv',
          notify: true,
          verify: false,
          avatar: 'mm',
          pageSize: '10',
          placeholder: 'Valine+Leancloud提供评论'
        })
      }
    }

    mod.load('lib-av', 'https://cdn.jsdelivr.net/npm/leancloud-storage@3.0.1/dist/av-min.js', () => {
      mod.load('lib-cmt', 'https://unpkg.com/valine@1.4.14/dist/Valine.min.js',()=>{
        let t = setTimeout(() => {
          mod.genCmt()
          clearTimeout(t)
          t = null;
        }, 100);
      })
    })
  </script>
  
  <script async defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  
  <script async defer src="https://s5.cnzz.com/z_stat.php?id=1276809529&web_id=1276809529"></script>
  
</body>
</html>