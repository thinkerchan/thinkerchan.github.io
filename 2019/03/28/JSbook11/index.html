<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <link rel="dns-prefetch" href="https://thinkerchan.com">
  
  <title>JSçº¢çš®ä¹¦è¯»ä¹¦ç¬”è®°-11-DOMæ‰©å±• | æµ‹è¯•ç‹—</title>
  <meta name="author" content="æµ‹è¯•ç‹—">
  
  <meta name="description" content="ğŸ¶">
  
  
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

  <meta property="og:title" content="JSçº¢çš®ä¹¦è¯»ä¹¦ç¬”è®°-11-DOMæ‰©å±•"/>
  <meta property="og:site_name" content="æµ‹è¯•ç‹—"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="alternate" href="/atom.xml" title="æµ‹è¯•ç‹—" type="application/atom+xml">

  <link rel="preload" as="style" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="https://github.githubassets.com/favicons/favicon.svg">
  <link href="https://unpkg.com" rel="dns-prefetch" />
  <link href="https://busuanzi.ibruce.info" rel="dns-prefetch" />
  <link href="https://cdn1.lncld.net" rel="dns-prefetch" />
  
  <link href="https://xpjzs0ff.api.lncld.net" rel="dns-prefetch" />
  
</head>

<body>
  <div class="container">
    <div class="left-col" style="background-image:url('https://tva1.sinaimg.cn/large/007S8ZIlly1giq5k8ty3tj306y0zkdix.jpg')">
      <div class="intrude-less">
        <header id="header" class="inner">
          <a href="/">
            <div class="profilepic"><img class="avatar" src='https://tva1.sinaimg.cn/large/007S8ZIlly1giq5t0agwnj30bf0b4jrk.jpg'></div>
          </a>
          <div class="author-name"><a href="/">æµ‹è¯•ç‹—</a></div>
          <p class="aboutme">ğŸ¶</p>
          <nav id="main-nav">
            <ul class="main">
              
              <li>
                
                  <a href="/archives">å½’æ¡£</a>
                
              </li>
              
              <li>
                
                  <a href="/categories">ä¸“é¢˜</a>
                
              </li>
              
              <li>
                
                  <a href="/friendlinks">å‹é“¾</a>
                
              </li>
              
              <li>
                
                  <a href="/life">å…³äº</a>
                
              </li>
              
              <li>
                
                  <a href="/search">æœç´¢</a>
                
              </li>
              
            </ul>
          </nav>
          <nav id="sub-nav">
            <div class="social">
              
              <a class="twitter" href="https://twitter.com/thinkerchan" title="Twitter">Twitter</a>
              
              
              
              <a class="github" href="https://github.com/thinkerchan" title="Github">Github</a>
              
              
              <a class="yuque" href="https://yuque.com/testdog" title="è¯­é›€">è¯­é›€</a>
              

              
            </div>
          </nav>
        </header>
      </div>
    </div>
    <div class="mid-col">
      <div class="mid-col-container">
        <div id="content" class="inner">
          <article class="post">

  
    <div class="meta">
      
<div class="date">

<time datetime="2019-03-28T15:46:00.000Z"
      
      data-updated="true"
       itemprop="datePublished">
  2019-03-28
</time>





</div>

    </div>
  
  <h1 class="title" itemprop="name">JSçº¢çš®ä¹¦è¯»ä¹¦ç¬”è®°-11-DOMæ‰©å±•</h1>
  <div class="entry-content" itemprop="articleBody">
    
    <div class="post-toc">
      <div class="toc-title">TOC</div>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#é€‰æ‹©ç¬¦API"><span class="toc-number">1.</span> <span class="toc-text">é€‰æ‹©ç¬¦API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#querySelector"><span class="toc-number">1.1.</span> <span class="toc-text">querySelector</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#querySelectorAll"><span class="toc-number">1.2.</span> <span class="toc-text">querySelectorAll</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#matchesSelector"><span class="toc-number">1.3.</span> <span class="toc-text">matchesSelector</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…ƒç´ éå†"><span class="toc-number">2.</span> <span class="toc-text">å…ƒç´ éå†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML5"><span class="toc-number">3.</span> <span class="toc-text">HTML5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ‰©å±•ä¸Classç›¸å…³çš„æ“ä½œ"><span class="toc-number">3.1.</span> <span class="toc-text">æ‰©å±•ä¸Classç›¸å…³çš„æ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç„¦ç‚¹ç®¡ç†"><span class="toc-number">3.2.</span> <span class="toc-text">ç„¦ç‚¹ç®¡ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTMLDocumentçš„å˜åŒ–"><span class="toc-number">3.3.</span> <span class="toc-text">HTMLDocumentçš„å˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å­—ç¬¦é›†å±æ€§"><span class="toc-number">3.4.</span> <span class="toc-text">å­—ç¬¦é›†å±æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è‡ªå®šä¹‰æ•°æ®å±æ€§"><span class="toc-number">3.5.</span> <span class="toc-text">è‡ªå®šä¹‰æ•°æ®å±æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ’å…¥æ ‡è®°"><span class="toc-number">3.6.</span> <span class="toc-text">æ’å…¥æ ‡è®°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ’å…¥æ–‡æœ¬"><span class="toc-number">3.7.</span> <span class="toc-text">æ’å…¥æ–‡æœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ»šåŠ¨"><span class="toc-number">3.8.</span> <span class="toc-text">æ»šåŠ¨</span></a></li></ol></li></ol>
    </div>
    
    <p>ä¸Šä¸€ç« è®²äº†DOMç›¸å…³çš„çŸ¥è¯†, å¯¹æ­¤, DOMç›¸å…³çš„APIå·²ç»èƒ½æ»¡è¶³ç»å¤§éƒ¨åˆ†å¼€å‘è€…çš„ä½¿ç”¨äº†. ä½†æ˜¯jQueryå®åœ¨æ˜¯å¤ªå¼ºå¤§,  ä»¥è‡³äºW3Cå¯¹å…¶é€‰æ‹©å™¨è¿›è¡Œäº†å‚è€ƒ, è€Œåè¿›è¡Œäº†æ‰©å±•.</p>
<h2 id="é€‰æ‹©ç¬¦API"><a href="#é€‰æ‹©ç¬¦API" class="headerlink" title="é€‰æ‹©ç¬¦API"></a>é€‰æ‹©ç¬¦API</h2><h3 id="querySelector"><a href="#querySelector" class="headerlink" title="querySelector"></a>querySelector</h3><p>ç”¨æ³•:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> body = <span class="built_in">document</span>.querySelector(<span class="string">'body'</span>);</span><br><span class="line"><span class="keyword">var</span> id_body = <span class="built_in">document</span>.querySelector(<span class="string">'#body'</span>);</span><br><span class="line"><span class="keyword">var</span> class_body = <span class="built_in">document</span>.querySelector(<span class="string">'.body'</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="querySelectorAll"><a href="#querySelectorAll" class="headerlink" title="querySelectorAll"></a>querySelectorAll</h3><p>ç”¨æ³•:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> divs = <span class="built_in">document</span>.querySelectorAll(<span class="string">'div'</span>);</span><br><span class="line"><span class="keyword">var</span> class_divs = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.div'</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="matchesSelector"><a href="#matchesSelector" class="headerlink" title="matchesSelector"></a><del>matchesSelector</del></h3><blockquote>
<p>ç¬”è€…å†™æ­¤æ–‡çš„æ—¶å€™(2019å¹´),æ­¤APIå·²ä½œåºŸ, æ­£ç¡®çš„APIä¸º <code>matches</code></p>
</blockquote>
<p>æ­¤APIç”¨å¾—æ¯”è¾ƒå°‘:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> body = <span class="built_in">document</span>.body;	<span class="comment">// å‡è®¾body.id="Jbody"</span></span><br><span class="line">body.matches(<span class="string">'#Jbody'</span>);	<span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<h2 id="å…ƒç´ éå†"><a href="#å…ƒç´ éå†" class="headerlink" title="å…ƒç´ éå†"></a>å…ƒç´ éå†</h2><p>ç•¥, æ­¤å¤„çš„APIæœ‰ç‚¹é¸¡è‚‹</p>
<h2 id="HTML5"><a href="#HTML5" class="headerlink" title="HTML5"></a>HTML5</h2><p>è¿™é‡Œåªè®²HTML5ä¸­ä¸DOMç›¸å…³çš„æ–°æ‰©å±•.</p>
<h3 id="æ‰©å±•ä¸Classç›¸å…³çš„æ“ä½œ"><a href="#æ‰©å±•ä¸Classç›¸å…³çš„æ“ä½œ" class="headerlink" title="æ‰©å±•ä¸Classç›¸å…³çš„æ“ä½œ"></a>æ‰©å±•ä¸Classç›¸å…³çš„æ“ä½œ</h3><ol>
<li><p>æ–°å¢getElementByClassName<br>æ˜¾ç„¶è¿™ä¸ªæ–¹æ³•å—åˆ°äº†jQueryçš„å¯å‘.</p>
</li>
<li><p>æ–°å¢classListçš„æ“ä½œ<br>å®ƒåˆä»¥ä¸‹å‡ ä¸ªæ–¹æ³•:</p>
</li>
</ol>
<ul>
<li>add(value)</li>
<li>remove(value)</li>
<li>contains(value)</li>
<li>toggle(value)</li>
</ul>
<p>ä»¥å¾€æˆ‘ä»¬<strong>åˆ é™¤</strong>(æ³¨æ„è¿™é‡Œè¯´çš„æ˜¯åˆ é™¤)ä¸€ä¸ªå…ƒç´ ä¸­çš„classä¸­çš„æŸä¸ªå€¼ä¼šæ¯”è¾ƒéº»çƒ¦,ç°åœ¨æœ‰äº†classList, æˆ‘ä»¬å¯ä»¥:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">div.classList.remove(<span class="string">'test'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="ç„¦ç‚¹ç®¡ç†"><a href="#ç„¦ç‚¹ç®¡ç†" class="headerlink" title="ç„¦ç‚¹ç®¡ç†"></a>ç„¦ç‚¹ç®¡ç†</h3><p>æ–°å¢: </p>
<ul>
<li>document.activeElement: å½“å‰ç„¦ç‚¹å…ƒç´ </li>
<li>document.hasFocus() : æ£€æµ‹æ–‡æ¡£æ˜¯å¦è·å¾—ç„¦ç‚¹</li>
</ul>
<h3 id="HTMLDocumentçš„å˜åŒ–"><a href="#HTMLDocumentçš„å˜åŒ–" class="headerlink" title="HTMLDocumentçš„å˜åŒ–"></a>HTMLDocumentçš„å˜åŒ–</h3><ol>
<li>å¼•å…¥readyState: document. readyState åªæœ‰ä¸¤ç§å€¼: â€˜loadingâ€™||â€™completeâ€™</li>
<li>å…¼å®¹æ¨¡å¼: document.compatMode , æ ‡å‡†æ¨¡å¼ä¸‹å®ƒçš„å€¼æ˜¯ â€œCSS1Compatâ€,é€šå¸¸æˆ‘ä»¬ç”¨ä¸åˆ°è¿™ä¸ªå±æ€§</li>
<li>headå±æ€§: ç±»ä¼¼document.body</li>
</ol>
<h3 id="å­—ç¬¦é›†å±æ€§"><a href="#å­—ç¬¦é›†å±æ€§" class="headerlink" title="å­—ç¬¦é›†å±æ€§"></a>å­—ç¬¦é›†å±æ€§</h3><p>document.charset, ç•¥</p>
<h3 id="è‡ªå®šä¹‰æ•°æ®å±æ€§"><a href="#è‡ªå®šä¹‰æ•°æ®å±æ€§" class="headerlink" title="è‡ªå®šä¹‰æ•°æ®å±æ€§"></a>è‡ªå®šä¹‰æ•°æ®å±æ€§</h3><p>ä¸ºäº†è§„èŒƒDOMå…ƒç´ ä¸­çš„è‡ªå®šä¹‰å±æ€§è¡Œä¸º, HTMLä¸ºå¼€å‘è€…æä¾›äº†è‡ªå®šä¹‰æ•°æ®çš„å±æ€§, çœ‹ç¤ºä¾‹:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> div = Jdiv; <span class="comment">//å‡è®¾å­˜åœ¨ä¸€ä¸ªè¿™æ ·çš„å…ƒç´ : &lt;div id="Jdiv" data-id="testDiv"&gt;&lt;/div&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–è‡ªå®šä¹‰å±æ€§çš„å€¼</span></span><br><span class="line"><span class="keyword">var</span> _id = div.dataset.id;	<span class="comment">// "testDiv"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®</span></span><br><span class="line">div.dataset.name = <span class="string">"testdog"</span>;	<span class="comment">// "testdog"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="æ’å…¥æ ‡è®°"><a href="#æ’å…¥æ ‡è®°" class="headerlink" title="æ’å…¥æ ‡è®°"></a>æ’å…¥æ ‡è®°</h3><ol>
<li>innerHTML</li>
</ol>
<p>HTML5å¯¹è¿™ä¸ªå±æ€§åšäº†ä¸€æ¬¡åŠ å¼º, æ¯”å¦‚:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨ç°ä»£æµè§ˆå™¨ä¸‹, scriptæ ‡ç­¾ä¼šè¢«å¿½ç•¥, ä½†æ˜¯æ—§ç‰ˆæœ¬çš„IEä¾æ—§éœ€è¦æ³¨æ„</span></span><br><span class="line"><span class="built_in">document</span>.body.innerHTML = <span class="string">'&lt;script&gt;alert(1)&lt;/script&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦å¤–, ä½¿ç”¨innerHTMLä¸€å®šè¦æ³¨æ„XSSçš„é—®é¢˜</span></span><br><span class="line"><span class="built_in">document</span>.body.innerHTML = <span class="string">'&lt;img src="ä¸å­˜åœ¨çš„åœ°å€" onerror="alert(1)"&gt;'</span>;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>ä¹¦ä¸Šè¯´: â€œå¹¶ä¸æ˜¯æ‰€æœ‰å…ƒç´ éƒ½æ”¯æŒinnerHTMLå±æ€§â€, è¿™å¥è¯å·²ç»è¿‡æ—¶, è°¨æ…å‚è€ƒ.</p>
</blockquote>
<ol start="2">
<li>outerHTML: ç•¥</li>
<li>insertAdjacentHTML(æ’å…¥ä½ç½®, htmlå­—ç¬¦ä¸²)<br>å®é™…ä¸Šè¿™ä¸ªæ–¹æ³•æ—©åœ¨IEå°±å®ç°äº†(IE6éƒ½èƒ½ç”¨), çœ‹ä¸‹åˆ—ç¤ºä¾‹å¾ˆå®¹æ˜“æ˜ç™½:</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- beforebegin --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"one"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- afterbegin --&gt;</span></span><br><span class="line">    foo</span><br><span class="line">    <span class="comment">&lt;!-- beforeend --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- afterend --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> d1 = <span class="built_in">document</span>.getElementById(<span class="string">'one'</span>);</span></span><br><span class="line"><span class="xml">    d1.insertAdjacentHTML('afterend', '<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"two"</span>&gt;</span>two<span class="tag">&lt;/<span class="name">div</span>&gt;</span>');</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">4. å†…å­˜å’Œæ€§èƒ½é—®é¢˜:</span><br><span class="line">ä½¿ç”¨innerHTMLæ„å‘³ç€æ€§èƒ½çš„å¼€é”€, å¦‚éå¿…è¦, å°½é‡å°‘ç”¨innerHTML</span><br><span class="line"></span><br><span class="line">### scrollIntoViewæ–¹æ³•</span><br><span class="line">ele. scrollIntoView()å³å¯è®©å…ƒç´ æ»šåŠ¨åˆ°ä¸æµè§ˆå™¨çª—å£é¡¶éƒ¨.</span><br><span class="line"></span><br><span class="line">## ä¸“æœ‰æ‰©å±•</span><br><span class="line">### æ–‡æ¡£æ¨¡å¼</span><br><span class="line">ç•¥, ç°åœ¨éƒ½ç”¨HTML5æ–‡æ¡£</span><br><span class="line"></span><br><span class="line">### childrenå±æ€§</span><br><span class="line">è¿˜è®°å¾—ä¹‹å‰çš„ele.childNodeså—? è™½ç„¶å®ƒè¿”å›çš„æ˜¯nodeListå¯¹è±¡, ä½†æ˜¯nodeListä¸­çš„å…ƒç´ èŠ‚ç‚¹, å…¶å®å°±å’Œele.childrenæ˜¯ç±»ä¼¼çš„, åªä¸è¿‡childrenè¿”å›çš„æ˜¯HTMLcollection.</span><br><span class="line"></span><br><span class="line">### containsæ–¹æ³•</span><br><span class="line">è¦æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯ä¸æ˜¯æŸä¸€ä¸ªèŠ‚ç‚¹çš„åä»£:</span><br><span class="line">``` js</span><br><span class="line">ele.contains(oneNode);	// bool</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶DOM3ä¹Ÿæä¾›äº†ä¸€ä¸ªæ–¹æ³•:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ele1.compareDocumentPosition(ele2);</span><br></pre></td></tr></table></figure></p>
<p>è¿™æœ‰ä¸€ä¸ªå‚è€ƒ: <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node/compareDocumentPosition" target="_blank" rel="noopener">MDN-compareDocumentPosition</a> , ä½†æ˜¯å› ä¸ºè¿™ä¸ªAPIè¿”å›çš„ç»“æœè¿˜è¦è¿›è¡Œä½è¿ç®—, æ“ä½œç›¸å¯¹éº»çƒ¦, æ•…ä¸æµè¡Œ.</p>
<h3 id="æ’å…¥æ–‡æœ¬"><a href="#æ’å…¥æ–‡æœ¬" class="headerlink" title="æ’å…¥æ–‡æœ¬"></a>æ’å…¥æ–‡æœ¬</h3><p>innerText, outerText , åªæ“ä½œæ–‡æœ¬å†…å®¹. </p>
<h3 id="æ»šåŠ¨"><a href="#æ»šåŠ¨" class="headerlink" title="æ»šåŠ¨"></a>æ»šåŠ¨</h3><p>ç•¥, ç›®å‰ele. scrollIntoView()æœ€å¸¸ç”¨.</p>

  </div>

</article>


  <nav id="pagenavi">
    
    <a href="/2019/04/02/JSbook12/" class="prev">ä¸Šä¸€ç¯‡ï¼šJSçº¢çš®ä¹¦è¯»ä¹¦ç¬”è®°-12-DOM2å’ŒDOM3(å¾…æ›´æ–°)</a>
    
    
    <a href="/2019/03/28/JSbook10/" class="next">ä¸‹ä¸€ç¯‡ï¼šJSçº¢çš®ä¹¦è¯»ä¹¦ç¬”è®°-10-DOM</a>
    
  </nav>

        </div>
        
        
          <div class="post-comments" id="Jcmt">
            <h1 class="post-comments-title">è®¿å®¢è¯„è®º</h1>
            <div id="Jcomment"></div>
          </div>
        
      </div>
      <footer id="footer" class="inner">
        Â© 2021 - æµ‹è¯•ç‹— -
        <span id="busuanzi_container_site_pv">PV <span id="busuanzi_value_site_pv"></span></span>
        <p>Powered by <a href="https://hexo.io/">Hexo</a> & <a href="https://github.com/thinkerchan/hexo-theme-greyshade">GreyShade</a></p>
      </footer>
    </div>
  </div>
  
  <script>
    let mod ={
      timePrefix:'t-',
      expire:1000*60*60,
      load:function(libName,libUrl,cb){
        let aval = (new Date).getTime() - localStorage.getItem(this.timePrefix+libName) < this.expire;
        let libStr = localStorage.getItem(libName)
        if (aval && libStr) {
          this.parseAndInsert(libStr)
          cb && cb(libStr);
        }else{
          this.ajax(libUrl,(str)=>{
            localStorage.setItem(libName, str)
            localStorage.setItem(this.timePrefix+libName, (new Date).getTime())
            this.parseAndInsert(str)
            cb && cb(str);
          })
        }
      },
      parseAndInsert(rawStr) {
        let script = document.createElement('script')
        script.innerHTML = rawStr
        document.body.appendChild(script)
      },
      ajax:function(url,cb){
        let xhr = new XMLHttpRequest;
        xhr.open('get', url, true)
        xhr.send();
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            cb && cb(xhr.responseText)
          }else{
            // console.log(xhr.readyState,xhr.status);
          }
        }
      },
      genCmt(){
        window.Valine && new Valine({
          el: '#Jcomment',
          appId: 'XPJzs0FfufkFfuBjbJraqhbo-gzGzoHsz',
          appKey: 'QoS0zL4Y2xTDviitGOPkvCGv',
          notify: true,
          verify: false,
          avatar: 'mm',
          pageSize: '10',
          placeholder: 'Valine+Leancloudæä¾›è¯„è®º'
        })
      }
    }

    mod.load('lib-av', 'https://cdn.jsdelivr.net/npm/leancloud-storage@3.0.1/dist/av-min.js', () => {
      mod.load('lib-cmt', 'https://unpkg.com/valine@1.4.14/dist/Valine.min.js',()=>{
        let t = setTimeout(() => {
          mod.genCmt()
          clearTimeout(t)
          t = null;
        }, 100);
      })
    })
  </script>
  
  <script async defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  
  <script async defer src="https://s5.cnzz.com/z_stat.php?id=1276809529&web_id=1276809529"></script>
  
</body>
</html>