<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <link rel="dns-prefetch" href="https://thinkerchan.com">
  
  <title>JSçº¢çš®ä¹¦è¯»ä¹¦ç¬”è®°-25-æ–°å…´çš„API | æµ‹è¯•ç‹—</title>
  <meta name="author" content="æµ‹è¯•ç‹—">
  
  <meta name="description" content="ğŸ¶">
  
  
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

  <meta property="og:title" content="JSçº¢çš®ä¹¦è¯»ä¹¦ç¬”è®°-25-æ–°å…´çš„API"/>
  <meta property="og:site_name" content="æµ‹è¯•ç‹—"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="alternate" href="/atom.xml" title="æµ‹è¯•ç‹—" type="application/atom+xml">

  <link rel="preload" as="style" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="https://github.githubassets.com/favicons/favicon.svg">
  <link href="https://unpkg.com" rel="dns-prefetch" />
  <link href="https://busuanzi.ibruce.info" rel="dns-prefetch" />
  <link href="https://cdn1.lncld.net" rel="dns-prefetch" />
  
  <link href="https://xpjzs0ff.api.lncld.net" rel="dns-prefetch" />
  
</head>

<body>
  <div class="container">
    <div class="left-col" style="background-image:url('https://tva1.sinaimg.cn/large/007S8ZIlly1giq5k8ty3tj306y0zkdix.jpg')">
      <div class="intrude-less">
        <header id="header" class="inner">
          <a href="/">
            <div class="profilepic"><img class="avatar" src='https://tva1.sinaimg.cn/large/007S8ZIlly1giq5t0agwnj30bf0b4jrk.jpg'></div>
          </a>
          <div class="author-name"><a href="/">æµ‹è¯•ç‹—</a></div>
          <p class="aboutme">ğŸ¶</p>
          <nav id="main-nav">
            <ul class="main">
              
              <li>
                
                  <a href="/archives">å½’æ¡£</a>
                
              </li>
              
              <li>
                
                  <a href="/categories">ä¸“é¢˜</a>
                
              </li>
              
              <li>
                
                  <a href="/friendlinks">å‹é“¾</a>
                
              </li>
              
              <li>
                
                  <a href="/life">å…³äº</a>
                
              </li>
              
              <li>
                
                  <a href="/search">æœç´¢</a>
                
              </li>
              
            </ul>
          </nav>
          <nav id="sub-nav">
            <div class="social">
              
              <a class="twitter" href="https://twitter.com/thinkerchan" title="Twitter">Twitter</a>
              
              
              
              <a class="github" href="https://github.com/thinkerchan" title="Github">Github</a>
              
              
              <a class="yuque" href="https://yuque.com/testdog" title="è¯­é›€">è¯­é›€</a>
              

              
            </div>
          </nav>
        </header>
      </div>
    </div>
    <div class="mid-col">
      <div class="mid-col-container">
        <div id="content" class="inner">
          <article class="post">

  <!-- æ–‡ç« é¡µç»“æ„ -->
  
    <div class="meta">
      
<div class="date">

<time datetime="2019-04-09T08:10:00.000Z"
      
      data-updated="true"
       itemprop="datePublished">
  2019-04-09
</time>





</div>

    </div>
  
  <h1 class="title" itemprop="name">JSçº¢çš®ä¹¦è¯»ä¹¦ç¬”è®°-25-æ–°å…´çš„API</h1>

  
  <p class="expired-tips">æé†’ï¼šæœ¬æ–‡æœ€åæ›´æ–°äº 946 å¤©å‰ï¼Œæ–‡ç« å†…å®¹å¯èƒ½å›  æŠ€æœ¯æ—¶æ•ˆæ€§ æˆ– é‡æ–°ä¿®æ”¹ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚</p>
  

  <div class="entry-content" itemprop="articleBody">
    
    <div class="post-toc">
      <div class="toc-title">TOC</div>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#requestAnimationFrame"><span class="toc-number">1.</span> <span class="toc-text">requestAnimationFrame</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ—©æœŸåŠ¨ç”»å¾ªç¯"><span class="toc-number">1.1.</span> <span class="toc-text">æ—©æœŸåŠ¨ç”»å¾ªç¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¾ªç¯é—´éš”çš„é—®é¢˜"><span class="toc-number">1.2.</span> <span class="toc-text">å¾ªç¯é—´éš”çš„é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Page-Visibility-API"><span class="toc-number">2.</span> <span class="toc-text">Page Visibility API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Geolocation-API"><span class="toc-number">3.</span> <span class="toc-text">Geolocation API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#File-API"><span class="toc-number">4.</span> <span class="toc-text">File API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FileReaderç±»å‹"><span class="toc-number">4.1.</span> <span class="toc-text">FileReaderç±»å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è¯»å–éƒ¨åˆ†å†…å®¹"><span class="toc-number">4.2.</span> <span class="toc-text">è¯»å–éƒ¨åˆ†å†…å®¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¯¹è±¡URL"><span class="toc-number">4.3.</span> <span class="toc-text">å¯¹è±¡URL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è¯»å–æ‹–æ”¾çš„æ–‡ä»¶"><span class="toc-number">4.4.</span> <span class="toc-text">è¯»å–æ‹–æ”¾çš„æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨XHRä¸Šä¼ æ–‡ä»¶"><span class="toc-number">4.5.</span> <span class="toc-text">ä½¿ç”¨XHRä¸Šä¼ æ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webè®¡æ—¶"><span class="toc-number">5.</span> <span class="toc-text">Webè®¡æ—¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebWorkers"><span class="toc-number">6.</span> <span class="toc-text">WebWorkers</span></a></li></ol>
    </div>
    
    <h2 id="requestAnimationFrame"><a href="#requestAnimationFrame" class="headerlink" title="requestAnimationFrame"></a>requestAnimationFrame</h2><h3 id="æ—©æœŸåŠ¨ç”»å¾ªç¯"><a href="#æ—©æœŸåŠ¨ç”»å¾ªç¯" class="headerlink" title="æ—©æœŸåŠ¨ç”»å¾ªç¯"></a>æ—©æœŸåŠ¨ç”»å¾ªç¯</h3><p>JSçš„åŠ¨ç”»å¾ˆé•¿æ—¶é—´ä»¥æ¥éƒ½æ˜¯ä½¿ç”¨è®¡æ—¶å™¨setIntervalæ¥è¾¾æˆçš„ã€‚å°±åƒè¿™æ ·ï¼š<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">updateAnimations</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        doAnimation1();</span><br><span class="line">        doAnimation2();</span><br><span class="line">    &#125;</span><br><span class="line">    setInterval(updateAnimations, <span class="number">100</span>);</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></p>
<h3 id="å¾ªç¯é—´éš”çš„é—®é¢˜"><a href="#å¾ªç¯é—´éš”çš„é—®é¢˜" class="headerlink" title="å¾ªç¯é—´éš”çš„é—®é¢˜"></a>å¾ªç¯é—´éš”çš„é—®é¢˜</h3><p>ä½†æ˜¯è¿™æ ·ä½¿ç”¨æ˜¯æœ‰é—®é¢˜çš„ï¼Œæœ€å¤§çš„é—®é¢˜å°±æ˜¯æ—¶é—´é—´éš”çš„é—®é¢˜ã€‚ä¸èƒ½å¤ªé•¿ï¼Œå¦åˆ™çœ‹èµ·æ¥å°±ä¼šå¡å¡çš„ï¼Œä¹Ÿä¸èƒ½å¤ªçŸ­ï¼Œæ›´æ–°é€Ÿåº¦è¶…è¿‡äº†å±å¹•çš„åˆ·æ–°é€Ÿåº¦ä¼šé€ æˆä¸¢å¸§ã€‚</p>
<p>è€Œä¸”æµè§ˆå™¨çš„è®¡æ—¶å™¨å…¶å®ç²¾åº¦æ˜¯æœ‰é™çš„ï¼Œç²¾åº¦æœ€é«˜çš„chromeä¸º4msã€‚ä¸”åœ¨é¡µé¢æ²¡æœ‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„æ—¶å€™ï¼Œå¤§å¤šæ•°æµè§ˆå™¨ä¼šå¯¹è®¡æ—¶å™¨çš„è¿è¡Œé¢‘ç‡åšå‡ºé™åˆ¶ã€‚<br>è¿™æ ·çš„åŠ¨ç”»ç»˜åˆ¶æœºåˆ¶å°±é€ æˆäº†ç»˜åˆ¶ä¸‹ä¸€å¸§åŠ¨ç”»çš„æ—¶æœºæˆ‘ä»¬å¹¶ä¸èƒ½å‡†ç¡®æŒæ¡ã€‚æœ€å¥½çš„ç»“æœåº”è¯¥æ˜¯æ­£å¥½åœ¨å±å¹•åˆ·æ–°çš„é‚£ä¸€åˆ»ç»˜åˆ¶ä¸‹ä¸€å¸§ï¼Œä¹Ÿå°±æ˜¯åŠ¨ç”»ç»˜åˆ¶çš„é€Ÿåº¦ä¸ç”µè„‘å±å¹•åˆ·æ–°é€Ÿåº¦ä¸€è‡´ã€‚</p>
<p>äºæ˜¯Mozillaå°±å¸¦å¤´æå‡ºäº†requestAnimationFrameè¿™ä¸ªAPI, å¦‚ä»Šè¿™ä¸ªAPIå·²ç»è¢«æ ‡å‡†åŒ–:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateProgress</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">"status"</span>);</span><br><span class="line">    div.style.width = (<span class="built_in">parseInt</span>(div.style.width, <span class="number">10</span>) + <span class="number">5</span>) + <span class="string">"%"</span>;</span><br><span class="line">    <span class="keyword">if</span> (div.style.width != <span class="string">"100%"</span>)&#123;</span><br><span class="line">        requestAnimationFrame(updateProgress);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">requestAnimationFrame(updateProgress);</span><br></pre></td></tr></table></figure></p>
<h2 id="Page-Visibility-API"><a href="#Page-Visibility-API" class="headerlink" title="Page Visibility API"></a>Page Visibility API</h2><p>ç”¨æˆ·æ˜¯å¦çœŸçš„æ­£åœ¨ä¸é¡µé¢äº¤äº’æ˜¯æˆ‘ä»¬éœ€è¦çŸ¥é“çš„ã€‚å¦‚æœé¡µé¢æœ€å°åŒ–äº†æˆ–éšè—èµ·æ¥äº†ï¼Œé‚£ä¹ˆæœ‰äº›åŠŸèƒ½æ˜¯å¯ä»¥åœä¸‹æ¥çš„ã€‚APIç”±3éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>document.hiddenï¼šè¡¨ç¤ºé¡µé¢æ˜¯å¦éšè—çš„å¸ƒå°”å€¼</li>
<li>document.visibilityStateï¼šé¡µé¢åœ¨åå°ï¼Œé¡µé¢åœ¨å‰å°ï¼Œé¡µé¢éšè—ä½†æ­£åœ¨è¢«é¢„è§ˆï¼Œé¡µé¢åœ¨å±å¹•å¤–æ‰§è¡Œé¢„æ¸²æŸ“å¤„ç†</li>
<li>visibilitychangeï¼šåœ¨å¯è§å’Œä¸å¯è§è½¬æ¢æ—¶è§¦å‘çš„äº‹ä»¶</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleVisibilityChange</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> output = <span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>),</span><br><span class="line">        msg;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">document</span>.hidden || <span class="built_in">document</span>.msHidden || <span class="built_in">document</span>.webkitHidden)&#123;</span><br><span class="line">        msg = <span class="string">"Page is now hidden. "</span> + (<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        msg = <span class="string">"Page is now visible. "</span> + (<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    output.innerHTML += msg;</span><br><span class="line">&#125;</span><br><span class="line">EventUtil.addHandler(<span class="built_in">document</span>, <span class="string">"msvisibilitychange"</span>, handleVisibilityChange);</span><br><span class="line">EventUtil.addHandler(<span class="built_in">document</span>, <span class="string">"webkitvisibilitychange"</span>, handleVisibilityChange);</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<a href="https://www.duowan.com/" target="_blank" rel="noopener">å¤šç©å®˜ç½‘</a> å°±ä½¿ç”¨äº†ä¸Šé¢ç›¸åº”çš„api, é¡µé¢æ²¡æœ‰æ˜¾ç¤ºçš„æ—¶å€™, titleä¼šæ”¹å˜.</p>
<h2 id="Geolocation-API"><a href="#Geolocation-API" class="headerlink" title="Geolocation API"></a>Geolocation API</h2><p>è¿™ä¸ªAPIè®©JSå¯ä»¥é€šè¿‡æµè§ˆå™¨æ¥è·å–ç”¨æˆ·çš„åœ°ç†ä½ç½®ã€‚å½“ç„¶ï¼Œè¿™æ˜¯éœ€è¦è·å¾—ç”¨æˆ·åŒæ„çš„ã€‚è¿™ä¸ªAPIåœ¨æµè§ˆå™¨ä¸­çš„å®ç°æ˜¯navigator.geolocationã€‚è¿™ä¸ªå¯¹è±¡æœ‰3ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>getCurrentPosition(successFn,failFn,configObj): é€šå¸¸ç”¨è¿™ä¸ªAPIè·å–ç»çº¬åº¦</li>
<li>watchPosition: getCurrentPositionçš„å®šæ—¶ç‰ˆæœ¬</li>
<li>clearWatch: å–æ¶ˆç›‘æ§</li>
</ul>
<h2 id="File-API"><a href="#File-API" class="headerlink" title="File API"></a>File API</h2><p>ä¸èƒ½ç›´æ¥è®¿é—®ç”¨æˆ·è®¡ç®—æœºä¸­çš„æ–‡ä»¶ï¼Œä¸€ç›´éƒ½æ˜¯ Web åº”ç”¨å¼€å‘ä¸­çš„ä¸€å¤§éšœç¢ã€‚2000 å¹´ä»¥å‰ï¼Œå¤„ç†æ–‡ä»¶çš„å”¯ä¸€æ–¹å¼å°±æ˜¯åœ¨è¡¨å•ä¸­åŠ å…¥<input type="file">å­—æ®µï¼Œä»…æ­¤è€Œå·²ã€‚File APIï¼ˆæ–‡ä»¶ APIï¼‰çš„å®—æ—¨æ˜¯ä¸º Web å¼€å‘äººå‘˜æä¾›ä¸€ç§å®‰å…¨çš„æ–¹å¼ï¼Œä»¥ä¾¿åœ¨å®¢æˆ·ç«¯è®¿é—®ç”¨æˆ·è®¡ç®—æœºä¸­çš„æ–‡ä»¶ï¼Œå¹¶æ›´å¥½åœ°å¯¹è¿™äº›æ–‡ä»¶æ‰§è¡Œæ“ä½œã€‚</p>
<p>File API åœ¨è¡¨å•ä¸­çš„æ–‡ä»¶è¾“å…¥å­—æ®µçš„åŸºç¡€ä¸Šï¼Œåˆæ·»åŠ äº†ä¸€äº›ç›´æ¥è®¿é—®æ–‡ä»¶ä¿¡æ¯çš„æ¥å£ã€‚HTML5 åœ¨DOM ä¸­ä¸ºæ–‡ä»¶è¾“å…¥å…ƒç´ æ·»åŠ äº†ä¸€ä¸ª files é›†åˆã€‚åœ¨é€šè¿‡æ–‡ä»¶è¾“å…¥å­—æ®µé€‰æ‹©äº†ä¸€æˆ–å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œfiles é›†åˆä¸­å°†åŒ…å«ä¸€ç»„ File å¯¹è±¡ï¼Œæ¯ä¸ª File å¯¹è±¡å¯¹åº”è‹¥ä¸€ä¸ªæ–‡ä»¶ã€‚æ¯ä¸ª File å¯¹è±¡éƒ½æœ‰ä¸‹åˆ—åªè¯»å±æ€§ã€‚</p>
<ul>
<li>nameï¼šæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶åã€‚</li>
<li>sizeï¼šæ–‡ä»¶çš„å­—èŠ‚å¤§å°ã€‚</li>
<li>typeï¼šå­—ç¬¦ä¸²ï¼Œæ–‡ä»¶çš„ MIME ç±»å‹ã€‚</li>
<li>lastModifiedDateï¼šå­—ç¬¦ä¸²ï¼Œæ–‡ä»¶ä¸Šä¸€æ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´ï¼ˆåªæœ‰ Chrome å®ç°äº†è¿™ä¸ªå±æ€§ï¼‰ã€‚</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œé€šè¿‡ä¾¦å¬ change äº‹ä»¶å¹¶è¯»å– files é›†åˆå°±å¯ä»¥çŸ¥é“é€‰æ‹©çš„æ¯ä¸ªæ–‡ä»¶çš„ä¿¡æ¯ï¼š<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> filesList = <span class="built_in">document</span>.getElementById(<span class="string">"files-list"</span>);</span><br><span class="line">    EventUtil.addHandler(filesList, <span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> info = <span class="string">""</span>,</span><br><span class="line">            output = <span class="built_in">document</span>.getElementById(<span class="string">"output"</span>),</span><br><span class="line">            files = EventUtil.getTarget(event).files,</span><br><span class="line">            i = <span class="number">0</span>,</span><br><span class="line">            len = files.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt; len)&#123;</span><br><span class="line">            info += files[i].name + <span class="string">" ("</span> + files[i].type + <span class="string">", "</span> + files[i].size + <span class="string">" bytes)&lt;br&gt;"</span>;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        output.innerHTML = info;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä¾‹å­åªæ˜¯ç®€å•è¯»å–äº†æ–‡ä»¶çš„ä¿¡æ¯, ä½†æ˜¯File APIè¿˜èƒ½åšå¾—æ›´å¤š, FileReaderèƒ½è¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®.</p>
<h3 id="FileReaderç±»å‹"><a href="#FileReaderç±»å‹" class="headerlink" title="FileReaderç±»å‹"></a>FileReaderç±»å‹</h3><p>FileReader ç±»å‹å®ç°çš„æ˜¯ä¸€ç§<strong>å¼‚æ­¥æ–‡ä»¶è¯»å–æœºåˆ¶</strong>ã€‚å¯ä»¥æŠŠFileReader æƒ³è±¡æˆXMLHttpRequestï¼Œ åŒºåˆ«åªæ˜¯å®ƒè¯»å–çš„æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸æ˜¯è¿œç¨‹æœåŠ¡å™¨ã€‚ä¸ºäº†è¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®ï¼ŒFileReader æä¾›äº†å¦‚ä¸‹å‡ ä¸ªæ–¹æ³•ã€‚</p>
<ul>
<li>readAsText(file,encoding)ï¼šä»¥çº¯æ–‡æœ¬å½¢å¼è¯»å–æ–‡ä»¶ï¼Œå°†è¯»å–åˆ°çš„æ–‡æœ¬ä¿å­˜åœ¨ result å±æ€§ä¸­ã€‚ç¬¬äºŒä¸ªå‚æ•°ç”¨äºæŒ‡å®šç¼–ç ç±»å‹ï¼Œæ˜¯å¯é€‰çš„ã€‚</li>
<li>readAsDataURL(file)ï¼šè¯»å–æ–‡ä»¶å¹¶å°†æ–‡ä»¶ä»¥æ•°æ® URI çš„å½¢å¼ä¿å­˜åœ¨ result å±æ€§ä¸­ã€‚</li>
<li>readAsBinaryString(file)ï¼šè¯»å–æ–‡ä»¶å¹¶å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¿å­˜åœ¨ result å±æ€§ä¸­ï¼Œå­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦è¡¨ç¤ºä¸€å­—èŠ‚ã€‚</li>
<li>readAsArrayBuffer(file) ï¼šè¯»å–æ–‡ä»¶å¹¶å°†ä¸€ä¸ªåŒ…å«æ–‡ä»¶å†…å®¹çš„ ArrayBuffer ä¿å­˜åœ¨result å±æ€§ä¸­ã€‚</li>
</ul>
<p>æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªä¾‹å­:<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>File API Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"EventUtil.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>This page is a demonstration of the File API. This works in the latest versions of all major browsers, but you may need to place this file on a web server to get it to work.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Select a file below.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"files-list"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> filesList = <span class="built_in">document</span>.getElementById(<span class="string">"files-list"</span>);</span></span><br><span class="line"><span class="javascript">      EventUtil.addHandler(filesList, <span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> info = <span class="string">""</span>,</span></span><br><span class="line"><span class="javascript">        output = <span class="built_in">document</span>.getElementById(<span class="string">"output"</span>),</span></span><br><span class="line"><span class="javascript">        progress = <span class="built_in">document</span>.getElementById(<span class="string">"progress"</span>),</span></span><br><span class="line"><span class="undefined">        files = EventUtil.getTarget(event).files,</span></span><br><span class="line"><span class="javascript">        type = <span class="string">"default"</span>,</span></span><br><span class="line"><span class="javascript">        reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="regexp">/image/</span>.test(files[<span class="number">0</span>].type))&#123;</span></span><br><span class="line"><span class="undefined">          reader.readAsDataURL(files[0]);</span></span><br><span class="line"><span class="javascript">          type = <span class="string">"image"</span>;</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">          reader.readAsText(files[0]);</span></span><br><span class="line"><span class="javascript">          type = <span class="string">"text"</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        reader.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">          output.innerHTML = <span class="string">"Could not read file, error code is "</span> + reader.error.code;</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        reader.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (event.lengthComputable)&#123;</span></span><br><span class="line"><span class="javascript">            progress.innerHTML = event.loaded + <span class="string">"/"</span> + event.total;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> html = <span class="string">""</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">          <span class="keyword">switch</span>(type)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">case</span> <span class="string">"image"</span>:</span></span><br><span class="line"><span class="javascript">            html = <span class="string">"&lt;img src=\""</span> + reader.result + <span class="string">"\"&gt;"</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">case</span> <span class="string">"text"</span>:</span></span><br><span class="line"><span class="undefined">            html = reader.result;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">          output.innerHTML = html;</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined">      &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"progress"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pre</span> <span class="attr">id</span>=<span class="string">"output"</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="è¯»å–éƒ¨åˆ†å†…å®¹"><a href="#è¯»å–éƒ¨åˆ†å†…å®¹" class="headerlink" title="è¯»å–éƒ¨åˆ†å†…å®¹"></a>è¯»å–éƒ¨åˆ†å†…å®¹</h3><p>ç•¥, ä½¿ç”¨åœºæ™¯æ¯”è¾ƒå°‘.</p>
<h3 id="å¯¹è±¡URL"><a href="#å¯¹è±¡URL" class="headerlink" title="å¯¹è±¡URL"></a>å¯¹è±¡URL</h3><p>å¯¹è±¡ URL ä¹Ÿè¢«ç§°ä¸º blob URLï¼ŒæŒ‡çš„æ˜¯å¼•ç”¨ä¿å­˜åœ¨ File æˆ– Blob ä¸­æ•°æ®çš„ URLã€‚ä½¿ç”¨å¯¹è±¡ URL çš„å¥½å¤„æ˜¯å¯ä»¥ä¸å¿…æŠŠæ–‡ä»¶å†…å®¹è¯»å–åˆ° JavaScript ä¸­è€Œç›´æ¥ä½¿ç”¨æ–‡ä»¶å†…å®¹ã€‚ä¸ºæ­¤ï¼Œåªè¦åœ¨éœ€è¦æ–‡ä»¶å†…å®¹çš„åœ°æ–¹æä¾›å¯¹è±¡ URL å³å¯ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.URL.createObjectURL(blob);		<span class="comment">//ä¼ å…¥fileå¯¹è±¡æˆ–è€…blob</span></span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬ç”¨ç¬¬ä¸‰æ–¹åŸŸåçš„å›¾ç‰‡(ç»å¯¹åœ°å€)å†canvas.toDataURLå¯¼å‡ºbase64çš„æ—¶å€™, æµè§ˆå™¨ä¼šæç¤ºcanvasè¢«æ±¡æŸ“. è™½ç„¶æˆ‘ä»¬å¯ä»¥å¯¹å›¾ç‰‡è®¾ç½®<code>crossOrigin</code>å±æ€§, ä½†è¿˜æ˜¯å­˜åœ¨å…¼å®¹é—®é¢˜.</p>
<p>æ­¤æ—¶åˆ©ç”¨window.URL.createObjectURLå°±èƒ½è§£å†³ä¸Šè¿°é—®é¢˜:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"demo"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> imgsrc = <span class="string">'https://thinkerchan.com/images/avatar.jpg'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getBase64</span>(<span class="params">img</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> can = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span></span><br><span class="line"><span class="undefined">      can.width = 200;</span></span><br><span class="line"><span class="undefined">      can.height = 200;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> ctx= can.getContext(<span class="string">'2d'</span>);</span></span><br><span class="line"><span class="undefined">      ctx.drawImage(img,0,0,200,200);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> base64 = can.toDataURL(<span class="string">"image/jpeg"</span>,<span class="number">0.6</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(base64)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> base64;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">normalImg</span>(<span class="params">src</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span></span><br><span class="line"><span class="undefined">      img.src =src;</span></span><br><span class="line"><span class="javascript">      img.crossOrigin = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">      img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="undefined">        demo.src = getBase64(img);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    normalImg(imgsrc); <span class="comment">// safariæŠ¥é”™</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getImageBlob</span>(<span class="params">url, cb</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> xhr          = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">      xhr.open(<span class="string">"get"</span>, url, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">      xhr.responseType = <span class="string">"blob"</span>;</span></span><br><span class="line"><span class="javascript">      xhr.onload       = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (xhr.status == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="undefined">          cb &amp;&amp;cb(xhr.response);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="undefined">      xhr.send();</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    getImageBlob(imgsrc, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> src = <span class="built_in">window</span>.URL.createObjectURL(res);  <span class="comment">//åˆ©ç”¨è¿™ä¸ªèƒ½å®Œç¾è§£å†³æŠ¥é”™</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span></span><br><span class="line"><span class="undefined">      img.src =src</span></span><br><span class="line"><span class="javascript">      img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="undefined">        demo.src = getBase64(img);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="è¯»å–æ‹–æ”¾çš„æ–‡ä»¶"><a href="#è¯»å–æ‹–æ”¾çš„æ–‡ä»¶" class="headerlink" title="è¯»å–æ‹–æ”¾çš„æ–‡ä»¶"></a>è¯»å–æ‹–æ”¾çš„æ–‡ä»¶</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>File API Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"EventUtil.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>This page is a demonstration of the File API with Drag and Drop. This works in the latest versions of all major browsers, but you may need to place this file on a web server to get it to work.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"droptarget"</span> <span class="attr">style</span>=<span class="string">"width: 500px; height: 200px; background: silver"</span>&gt;</span></span><br><span class="line">    Drop some files here</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> droptarget = <span class="built_in">document</span>.getElementById(<span class="string">"droptarget"</span>);</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">handleEvent</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> info = <span class="string">""</span>,</span></span><br><span class="line"><span class="javascript">          output = <span class="built_in">document</span>.getElementById(<span class="string">"output"</span>),</span></span><br><span class="line"><span class="undefined">          files, i, len;</span></span><br><span class="line"><span class="undefined">        EventUtil.preventDefault(event);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (event.type == <span class="string">"drop"</span>)&#123;</span></span><br><span class="line"><span class="undefined">          files = event.dataTransfer.files;</span></span><br><span class="line"><span class="undefined">          i = 0;</span></span><br><span class="line"><span class="undefined">          len = files.length;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">while</span> (i &lt; len)&#123;</span></span><br><span class="line"><span class="javascript">            info += files[i].name + <span class="string">" ("</span> + files[i].type + <span class="string">", "</span> + files[i].size + <span class="string">" bytes)&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="undefined">            i++;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">          output.innerHTML = info;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="javascript">      EventUtil.addHandler(droptarget, <span class="string">"dragenter"</span>, handleEvent);</span></span><br><span class="line"><span class="javascript">      EventUtil.addHandler(droptarget, <span class="string">"dragover"</span>, handleEvent);</span></span><br><span class="line"><span class="javascript">      EventUtil.addHandler(droptarget, <span class="string">"drop"</span>, handleEvent);</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pre</span> <span class="attr">id</span>=<span class="string">"output"</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨XHRä¸Šä¼ æ–‡ä»¶"><a href="#ä½¿ç”¨XHRä¸Šä¼ æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨XHRä¸Šä¼ æ–‡ä»¶"></a>ä½¿ç”¨XHRä¸Šä¼ æ–‡ä»¶</h3><p>é€šè¿‡ File API èƒ½å¤Ÿè®¿é—®åˆ°æ–‡ä»¶å†…å®¹ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹å°±å¯ä»¥é€šè¿‡ XHR ç›´æ¥æŠŠæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚å½“ç„¶å•¦ï¼ŒæŠŠæ–‡ä»¶å†…å®¹æ”¾åˆ° send()æ–¹æ³•ä¸­ï¼Œå†é€šè¿‡ POST è¯·æ±‚ï¼Œçš„ç¡®å¾ˆå®¹æ˜“å°±èƒ½å®ç°ä¸Šä¼ ã€‚ä½†è¿™æ ·åšä¼ é€’çš„æ˜¯æ–‡ä»¶å†…å®¹ï¼Œå› è€ŒæœåŠ¡å™¨ç«¯å¿…é¡»æ”¶é›†æäº¤çš„å†…å®¹ï¼Œç„¶åå†æŠŠå®ƒä»¬ä¿å­˜åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p>
<p>å…¶å®ï¼Œæ›´å¥½çš„åšæ³•æ˜¯ä»¥è¡¨å•æäº¤çš„æ–¹å¼æ¥ä¸Šä¼ æ–‡ä»¶ã€‚è¿™æ ·ä½¿ç”¨ FormData ç±»å‹å°±å¾ˆå®¹æ˜“åšåˆ°äº†ï¼ˆç¬¬ 21 ç« ä»‹ç»è¿‡ FormDataï¼‰ã€‚é¦–å…ˆï¼Œè¦åˆ›å»ºä¸€ä¸ª FormDataå¯¹è±¡ï¼Œé€šè¿‡å®ƒè°ƒç”¨ append()æ–¹æ³•å¹¶ä¼ å…¥ç›¸åº”çš„ File å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚ç„¶åï¼Œå†æŠŠ FormData å¯¹è±¡ä¼ é€’ç»™ XHR çš„ send()æ–¹æ³•ï¼Œç»“æœä¸é€šè¿‡è¡¨å•ä¸Šä¼ ä¸€æ¨¡ä¸€æ ·:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (event.type == <span class="string">"drop"</span>)&#123;</span><br><span class="line">  data = <span class="keyword">new</span> FormData();</span><br><span class="line">    files = event.dataTransfer.files;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    len = files.length;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; len)&#123;</span><br><span class="line">        data.append(<span class="string">"file"</span> + i, files[i]);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.open(<span class="string">"post"</span>, <span class="string">"server.php"</span>, <span class="literal">true</span>);</span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">            alert(xhr.responseText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.send(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Webè®¡æ—¶"><a href="#Webè®¡æ—¶" class="headerlink" title="Webè®¡æ—¶"></a>Webè®¡æ—¶</h2><p>ç•¥, æ€§èƒ½ä¼˜åŒ–çš„æ—¶å€™ å†è®²è¿™ä¸ª</p>
<h2 id="WebWorkers"><a href="#WebWorkers" class="headerlink" title="WebWorkers"></a>WebWorkers</h2><p>ç•¥, å¦å¼€ä¸€ç¯‡æ–‡ç« è®²è§£</p>
<hr>
<p>æœ¬ç« å®Œ</p>

  </div>

</article>


  <nav id="pagenavi">
    
    <a href="/2019/04/12/indexeddb-quick/" class="prev">ä¸Šä¸€ç¯‡ï¼šã€å¿«é€Ÿæ•™ç¨‹ã€‘Webç¦»çº¿å­˜å‚¨ä¹‹indexedDB</a>
    
    
    <a href="/2019/04/09/JSbook24/" class="next">ä¸‹ä¸€ç¯‡ï¼šJSçº¢çš®ä¹¦è¯»ä¹¦ç¬”è®°-24-æœ€ä½³å®è·µ</a>
    
  </nav>

        </div>
        
        
          <div class="post-comments" id="Jcmt">
            <h1 class="post-comments-title">è®¿å®¢è¯„è®º</h1>
            <div id="Jcomment"></div>
          </div>
        
      </div>
      <footer id="footer" class="inner">
        Â© 2021 - æµ‹è¯•ç‹— -
        <span id="busuanzi_container_site_pv">PV <span id="busuanzi_value_site_pv"></span></span>
        <p>Powered by <a href="https://hexo.io/">Hexo</a> & <a href="https://github.com/thinkerchan/hexo-theme-greyshade">GreyShade</a></p>
      </footer>
    </div>
  </div>
  
  <script>
    let mod ={
      timePrefix:'t-',
      expire:1000*60*60,
      load:function(libName,libUrl,cb){
        let aval = (new Date).getTime() - localStorage.getItem(this.timePrefix+libName) < this.expire;
        let libStr = localStorage.getItem(libName)
        if (aval && libStr) {
          this.parseAndInsert(libStr)
          cb && cb(libStr);
        }else{
          this.ajax(libUrl,(str)=>{
            localStorage.setItem(libName, str)
            localStorage.setItem(this.timePrefix+libName, (new Date).getTime())
            this.parseAndInsert(str)
            cb && cb(str);
          })
        }
      },
      parseAndInsert(rawStr) {
        let script = document.createElement('script')
        script.innerHTML = rawStr
        document.body.appendChild(script)
      },
      ajax:function(url,cb){
        let xhr = new XMLHttpRequest;
        xhr.open('get', url, true)
        xhr.send();
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            cb && cb(xhr.responseText)
          }else{
            // console.log(xhr.readyState,xhr.status);
          }
        }
      },
      genCmt(){
        window.Valine && new Valine({
          el: '#Jcomment',
          appId: 'XPJzs0FfufkFfuBjbJraqhbo-gzGzoHsz',
          appKey: 'QoS0zL4Y2xTDviitGOPkvCGv',
          notify: true,
          verify: false,
          avatar: 'mm',
          pageSize: '10',
          placeholder: 'Valine+Leancloudæä¾›è¯„è®º'
        })
      }
    }

    mod.load('lib-av', 'https://cdn.jsdelivr.net/npm/leancloud-storage@3.0.1/dist/av-min.js', () => {
      mod.load('lib-cmt', 'https://unpkg.com/valine@1.4.14/dist/Valine.min.js',()=>{
        let t = setTimeout(() => {
          mod.genCmt()
          clearTimeout(t)
          t = null;
        }, 100);
      })
    })
  </script>
  
  <script async defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  
  <script async defer src="https://s5.cnzz.com/z_stat.php?id=1276809529&web_id=1276809529"></script>
  
</body>
</html>